<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>ちいたん ユーザガイド</title>

<link rel="stylesheet" type="text/css" media="all" href="css/userguide.css" />
<link rel="stylesheet" type="text/css" media="all" href="css/site.css" />

<meta http-equiv="expires" content="-1" />
<meta http-equiv="pragma" content="no-cache" />
<meta name="robots" content="all" />

</head>
<body>

<!-- START NAVIGATION -->
<div id="nav"><div id="nav_inner"></div></div>
<div id="nav2"><a name="top"><br /></a></div>
<div id="masthead">
<table cellpadding="0" cellspacing="0" border="0" style="width:100%">
<tr>
<td><h1>ちいたん ユーザガイド Version 0.8.1.0</h1></td>
<td id="breadcrumb_right"><a href="toc.html">目次</a></td>
</tr>
</table>
</div>
<!-- END NAVIGATION -->


<!-- START BREADCRUMB -->
<table cellpadding="0" cellspacing="0" border="0" style="width:100%">
<tr>
<td id="breadcrumb">
<a href="javascript:void(0);">ホーム</a> &nbsp;&#8250;&nbsp;
<a href="index.html">ユーザガイド ホーム</a> &nbsp;&#8250;&nbsp;
コンフィグファイル
</td>
</tr>
</table>
<!-- END BREADCRUMB -->

<br clear="all" />



<!-- START CONTENT -->
<div id="content">


<h1>コンフィグファイル</h1>

<p>
ちいたんではコントローラーのアクションを実行する前に、フレームワークからいくつかの設定用関数が呼ばれます。
それによりデータベースやモデル、セッションといった機能の設定を行います。
ユーザーが設定関数を宣言していなかった場合、デフォルトの動作が行われるため必要なければ設定を行わなくても動作します。
</p>


<h2>関数宣言</h2>

<p>
設定関数は<kbd>config.php</kbd>ファイルにまとめて宣言することを推奨しています。
各々のページで<dfn>cheetan.php</dfn>をrequireする前に<kbd>config.php</kbd>をrequireします。
特定のページのみに別の動作を行わせたい時は<kbd>config.php</kbd>内の関数を以下のように宣言します。
そして、ページでは<kbd>config.php</kbd>をrequireする前に関数を宣言します。
</p>

<h3>config.php</h3>

<pre>
if ( !function_exists( 'config_function' ) ) {
	function config_function()
	{
		return true;
	}
}
</pre>

<h3>onepage.php</h3>

<pre>
&lt;?php
function config_function()
{
	return false;
}
	require_once 'config.php';
	require_once 'cheetan.php';
</pre>


<h2>設定関数</h2>

<ul>
<li>function is_session()</li>
<li>function config_controller_class()</li>
<li>function config_view_class()</li>
<li>function config_database( CDatabase &amp;db )</li>
<li>function config_models( CController &amp;controller )</li>
<li>function config_components( CController &amp;controller )</li>
<li>function is_secure( CController &amp;controller )</li>
<li>function check_secure( CController &amp;controller )</li>
<li>function config_controller( CController &amp;controller )</li>
<li>function after_action( CController &amp;controller )</li>
<li>function after_render( CController &amp;controller )</li>
</ul>

<h3>function is_session()</h3>

<p>
セッションを使用するかどうかを設定します。
デフォルト(関数を宣言しない時)はセッションを使用します。
使用したくない時は関数を宣言し、<var>FALSE</var>を返してください。
</p>

<pre>
function is_session()
{
	return FALSE;
}
</pre>


<h3>function config_controller_class()</h3>

<p>
コントローラクラスをオーバーライドしたい時に宣言します。
</p>

<pre>
function config_controller_class()
{
	class CMyController extends CController
	{

	}
	return 'CMyController';
}
</pre>


<h3>function config_view_class()</h3>

<p>
ビュークラスをオーバーライドしたい時に宣言します。
</p>

<pre>
function config_view_class()
{
	class CMyView extends CView
	{

	}
	return 'CMyView';
}
</pre>


<h3>function config_database( CDatabase <var>&amp;db</var> )</h3>

<p>
データベースの設定を行います。
以下の関数を利用してデータベースを設定します。
</p>

<code>
function CDatabase::add( string <samp>settingname</samp>, string <samp>host</samp>, string <samp>user</samp>, string <samp>password</samp>, string <samp>dbname</samp> )
</code>

<p>
<samp>host</samp>以降は特に説明は必要ないでしょう。
<samp>settingname</samp>は複数の接続を利用したい時の識別子です。
モデルやデータベースのクエリー関数で指定できます。
特に一つしか使わない場合は名前を指定しないとデフォルトの設定として呼び出されます。
</p>

<pre>
function config_database( &amp;$db )
{
	$db-&gt;add( '', 'localhost', 'user', 'password', 'dbname' );
	$db-&gt;add( 'special', '192.168.0.100', 'user', 'password', 'dbname' );
}
</pre>


<h3>function config_models( CController <var>&amp;controller</var> )</h3>

<p>
コントローラーにモデルを読み込みます。
以下の関数を利用してモデルの設定を行います。
</p>

<code>
function CController::AddModel( string <samp>filepath</samp> [, string <samp>name</samp> ] )
</code>

<p>
<samp>filepath</samp>はモデルを宣言してあるファイルを指定します。
デフォルトではファイル名の一文字目のみを大文字にして頭に<var>C</var>をつけたクラスを宣言します（<kbd>user.php</kbd>の場合<var>CUser</var>）。
そしてファイル名と同じテーブルを参照します。
</p>

<p>
通常コントローラの<var>$m</var>配列とメンバ変数、ファイル名と同じ名前で保存されます。
<samp>name</samp>を指定することによってその名前に変更できます。
</p>

<pre>
function config_models( &amp;$controller )
{
	$controller-&gt;db-&gt;query( 'SET NAMES ujis' );	//if you need
	$controller-&gt;AddModel( dirname( __FILE__ ) . '/models/user.php' );
}
</pre>


<h3>function config_components( CController <var>&amp;controller</var> )</h3>

<p>
コントローラーにコンポーネントを読み込みます。
以下の関数を利用してコンポーネントの設定を行います。
</p>

<code>
function CController::AddComponent( string <samp>filepath</samp> [, string <samp>cname</samp> [, string <samp>name</samp> ] ] )
</code>

<p>
<samp>filepath</samp>はコンポーネントを宣言してあるファイルを指定します。
デフォルトではファイル名の一文字目のみを大文字にして頭に<var>C</var>をつけたクラスを宣言します（<kbd>user.php</kbd>の場合<var>CUser</var>）。
そしてファイル名と同じテーブルを参照します。
クラス名は<samp>cname</samp>によって変更できます。
また、<samp>name</samp>を指定すれば<var>$c[name]</var>とコントローラの<samp>name</samp>変数に保存するよう指定できます。
</p>

<pre>
function config_components( &amp;$controller )
{
	$controller-&gt;AddComponent( dirname( __FILE__ ) . '/components/mail.php' );
	$controller-&gt;AddComponent( 'Smarty/Smarty.class.php', 'Smarty', 'smarty' );
	$controller-&gt;SetViewExt( '.tpl' );
}
</pre>


<h3>function is_secure( CController <var>&amp;controller</var> )<br />
function check_secure( CController <var>&amp;controller</var> )</h3>

<p>
ユーザー認証用の設定関数<kbd>check_secure</kbd>を呼び出すかどうかを<kbd>is_secure</kbd>で設定します。
デフォルト (<kbd>is_secure</kbd>関数を宣言しない時）は<kbd>check_secure</kbd>は呼び出されません。
認証を行いたい時は<var>TRUE</var>を返します。
</p>

<pre>
function is_secure( &amp;$controller )
{
	return TRUE;
}

function check_secure( &amp;$controller )
{
	if ( empty( $_SESSION['user'] ) ) {
		$controller-&gt;redirect( 'login.php' );
	}
}
</pre>


<h3>function config_controller( CController <var>&amp;controller</var> )</h3>

<p>
アクションが呼ばれる直前に呼ばれる関数です。
特に何をするべきという関数ではありませんので必要に応じて使用します。
下記サンプルでは共通テンプレートファイルを設定しています。
</p>

<pre>
function config_controller( &amp;$controller )
{
	$controller-&gt;SetTemplateFile( 'template.html' );
}
</pre>


<h3>function after_action( CController <var>&amp;controller</var> )</h3>

<p>
アクションが呼ばれた直後に呼ばれる関数です。
特に何をするべきという関数ではありませんので必要に応じて使用します。
smartyで出力を行っています。
</p>

<pre>
function after_action( &amp;$controller )
{
	$view = $controller-&gt;GetViewFile();
	$controller-&gt;smarty-&gt;display( $view );
	exit();
}
</pre>


<h3>function after_render( CController &amp;controller )</h3>

<p>
ビューが呼ばれた直後に呼ばれる関数です。
特に何をするべきという関数ではありませんので必要に応じて使用します。
</p>


</div>
<!-- END CONTENT -->


<div id="footer">
<p>
前のトピック:&nbsp;&nbsp;<a href="tutorial.html">チュートリアル</a>
&nbsp;&nbsp;&nbsp;&middot;&nbsp;&nbsp;
<a href="configfile.html#top">ページトップ</a>&nbsp;&nbsp;&nbsp;&middot;&nbsp;&nbsp;
<a href="index.html">ユーザガイド ホーム</a>&nbsp;&nbsp;&nbsp;&middot;&nbsp;&nbsp;
次のトピック:&nbsp;&nbsp;<a href="model.html">モデル</a>
</p>
<p><a href="http://php.cheetan.net/">Cheetan</a> &nbsp;&middot;&nbsp; Copyright &#169; 2006-2008 &nbsp;&middot;&nbsp; <a href="http://www.alphabrend.com/">Alphabrend</a><br />Powered by CodeIgniter Documents CSS.</p>
</div>

<script type="text/javascript"><!--
var fc2footerparam = 'charset=' + (document.charset ? document.charset : document.characterSet) + '&url=' + document.location + '&service=0&r=' + Math.floor(Math.random()*99999999999);
var fc2footertag = '<' + 'script src="//vip.chps-api.fc2.com/apis/footer/?' + fc2footerparam + '" charset="UTF-8"><' + '/script>';
document.write(fc2footertag);
//--></script>
<!-- FC2, inc.-->
<img src="http://media.fc2.com/counter_img.php?id=50" style="visibility:hidden" alt="inserted by FC2 system" width="0" height="0">
<!-- FC2, inc.-->
</body>
</html>
